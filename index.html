<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Private Blackjack — Password Protected</title>
<style>
  :root{
    --bg:#0f1724; --card:#fff; --accent:#0b76ff; --panel:#0b1220;
    --muted:#94a3b8;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;color:#e6eef6;background:linear-gradient(180deg,#071125 0%, #0b1728 100%);-webkit-font-smoothing:antialiased}
  .center{display:flex;align-items:center;justify-content:center;height:100%;padding:24px;box-sizing:border-box}
  .card-wrap{width:100%;max-width:1100px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));border-radius:14px;padding:18px;box-shadow:0 10px 40px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
  header h1{margin:0;font-size:18px;letter-spacing:0.2px}
  .credits{font-weight:700;color:var(--accent)}
  /* layout */
  .board{display:grid;grid-template-columns:1fr 360px;gap:16px}
  @media(max-width:920px){ .board{grid-template-columns:1fr} }
  .play-area{background:rgba(255,255,255,0.02);border-radius:10px;padding:14px;min-height:360px}
  .controls{display:flex;gap:8px;align-items:center;margin-top:12px;flex-wrap:wrap}
  .btn{background:var(--accent);color:#fff;border:0;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}
  .btn:disabled{opacity:0.45;cursor:not-allowed}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border-radius:10px;padding:12px}
  .hand{display:flex;gap:10px;align-items:flex-start;min-height:120px}
  .card{width:78px;height:110px;border-radius:10px;background:var(--card);display:flex;flex-direction:column;justify-content:space-between;padding:8px;box-shadow:0 6px 18px rgba(2,6,23,0.45);font-weight:800}
  .card .top,.card .bottom{font-size:16px;color:#111}
  .card .center{font-size:28px;text-align:center;color:#111}
  .small{font-size:13px;color:var(--muted)}
  .status{margin-top:10px;font-weight:800;font-size:16px}
  /* password modal */
  #entry{position:fixed;inset:0;background:linear-gradient(180deg, rgba(1,6,15,0.8), rgba(2,9,24,0.95));display:flex;align-items:center;justify-content:center;z-index:9999}
  #entry .box{width:100%;max-width:420px;background:linear-gradient(180deg,#071225,#071225);padding:26px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);text-align:center;color:#e6eef6}
  #entry input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);margin-top:12px;background:transparent;color:#fff}
  #entry button{margin-top:12px;padding:10px 14px;border-radius:10px;border:0;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
  #entry .hint{margin-top:8px;color:var(--muted);font-size:13px}
  /* animations */
  .card.deal{transform:translateY(-8px);transition:transform 150ms ease}
  footer{margin-top:14px;font-size:12px;color:var(--muted)}
  .log-list{max-height:220px;overflow:auto;margin-top:8px;padding:6px;background:rgba(0,0,0,0.12);border-radius:8px}
  .log-item{font-size:12px;padding:6px;border-bottom:1px dashed rgba(255,255,255,0.02);color:#cfe6ff}
  .top-row{display:flex;justify-content:space-between;gap:12px;align-items:center}
</style>
</head>
<body>
<div id="entry">
  <div class="box">
    <h2>Private Blackjack — Enter Password</h2>
    <input id="pw" type="password" placeholder="Enter Password" autofocus />
    <button id="enterBtn">Enter</button>
    <div class="hint">This page is private. Contact owner for changes.</div>
    <div id="pwMsg" style="color:#ffb4b4;margin-top:8px;font-weight:700"></div>
  </div>
</div>

<div class="center" id="app" style="display:none">
  <div class="card-wrap">
    <header>
      <h1>Blackjack — Private Table</h1>
      <div class="credits">Credits: ₹ <span id="credits">1000</span></div>
    </header>

    <div class="board">
      <div class="play-area panel">
        <div class="top-row">
          <div>
            <div class="small">Dealer</div>
            <div id="dealerHand" class="hand" aria-live="polite"></div>
            <div id="dealerValue" class="small">Value: ?</div>
          </div>
          <div>
            <div class="small">Player</div>
            <div id="playerHand" class="hand" aria-live="polite"></div>
            <div id="playerValue" class="small">Value: ?</div>
          </div>
        </div>

        <div class="controls" style="margin-top:18px">
          <label class="small">Bet: ₹
            <input id="bet" type="number" value="50" min="1" style="width:120px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff" />
          </label>
          <button id="dealBtn" class="btn">Deal</button>
          <button id="hitBtn" class="btn ghost" disabled>Hit</button>
          <button id="standBtn" class="btn ghost" disabled>Stand</button>
          <button id="resetBtn" class="btn ghost">Reset Credits</button>
        </div>

        <div class="status" id="status">Welcome — press Deal to start</div>
        <footer class="small">Fair, client-side crypto RNG (browser). For production/legal use, integrate server RNG, KYC & payments.</footer>
      </div>

      <aside class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>Round log</strong><div class="small">auditable local logs (localStorage)</div></div>
          <div><button id="exportBtn" class="btn ghost">Export</button></div>
        </div>
        <div class="log-list" id="logList" aria-live="polite"></div>

        <div style="margin-top:12px">
          <div class="small">Controls</div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="toggleSound" class="btn ghost">Sound: On</button>
            <button id="clearLogs" class="btn ghost">Clear Logs</button>
          </div>
        </div>

      </aside>
    </div>
  </div>
</div>

<script>
/* ---------- PASSWORD GATE ---------- */
const ENTRY_PASS = "Welcome100";
const entryEl = document.getElementById('entry');
const appEl = document.getElementById('app');
const pwInput = document.getElementById('pw');
const msg = document.getElementById('pwMsg');
const enterBtn = document.getElementById('enterBtn');

function unlockUI(){
  sessionStorage.setItem('bj_access','1');
  entryEl.style.display='none';
  appEl.style.display='flex';
}
enterBtn.addEventListener('click', ()=>{
  const v = pwInput.value || '';
  if(v === ENTRY_PASS){
    unlockUI();
    initGame();
  } else {
    msg.textContent = 'Incorrect password';
    pwInput.value='';
    pwInput.focus();
  }
});
pwInput.addEventListener('keydown',(e)=>{ if(e.key==='Enter') enterBtn.click(); });

// auto-unlock if session active
if(sessionStorage.getItem('bj_access') === '1'){
  entryEl.style.display='none';
  appEl.style.display='flex';
  setTimeout(initGame,50);
}

/* ---------- GAME ENGINE ---------- */

/* fast, cryptographically seeded shuffle via window.crypto */
function secureShuffle(array){
  // Fisher-Yates using crypto.getRandomValues
  const a = array.slice();
  for(let i=a.length-1;i>0;i--){
    // get random 32-bit unsigned, scale
    const r = crypto.getRandomValues(new Uint32Array(1))[0] / 0xFFFFFFFF;
    const j = Math.floor(r * (i+1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function newDeck(){
  const suits = ['♠','♥','♦','♣'];
  const vals = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
  const deck = [];
  for(const s of suits) for(const v of vals) deck.push({s,v});
  return secureShuffle(deck);
}

function cardValue(c){
  if(c.v === 'A') return [1,11];
  if(['J','Q','K'].includes(c.v)) return 10;
  return parseInt(c.v,10);
}
function handValue(hand){
  let total = 0, aces = 0;
  for(const c of hand){
    if(c.v === 'A'){ aces++; total += 1; } else total += (Array.isArray(cardValue(c)) ? 0 : cardValue(c)) || cardValue(c);
  }
  // upgrade some aces to 11 if possible
  for(let i=0;i<aces;i++){
    if(total + 10 <= 21) total += 10;
  }
  return total;
}

/* ---------- UI & State ---------- */
let state = {
  deck: [],
  player: [],
  dealer: [],
  bet: 50,
  credits: Number(localStorage.getItem('bj_credits') || 1000),
  inRound: false,
  sound: true
};

const creditsEl = document.getElementById('credits');
const dealerHandEl = document.getElementById('dealerHand');
const playerHandEl = document.getElementById('playerHand');
const dealerValueEl = document.getElementById('dealerValue');
const playerValueEl = document.getElementById('playerValue');
const statusEl = document.getElementById('status');
const dealBtn = document.getElementById('dealBtn');
const hitBtn = document.getElementById('hitBtn');
const standBtn = document.getElementById('standBtn');
const resetBtn = document.getElementById('resetBtn');
const betInput = document.getElementById('bet');
const logList = document.getElementById('logList');
const exportBtn = document.getElementById('exportBtn');
const clearLogsBtn = document.getElementById('clearLogs');
const toggleSoundBtn = document.getElementById('toggleSound');

function saveCredits(){ localStorage.setItem('bj_credits', String(state.credits)); creditsEl.textContent = state.credits; }

function pushLog(obj){
  const logs = JSON.parse(localStorage.getItem('bj_logs')||'[]');
  obj.ts = new Date().toISOString();
  logs.unshift(obj);
  localStorage.setItem('bj_logs', JSON.stringify(logs.slice(0,500)));
  renderLogs();
}

function renderLogs(){
  const logs = JSON.parse(localStorage.getItem('bj_logs')||'[]');
  logList.innerHTML = logs.slice(0,200).map(l=>`<div class="log-item">[${l.ts}] ${l.event} — ${l.note || ''}</div>`).join('');
}

function renderHands(){
  // dealer: show hole as ? when inRound and not revealed
  dealerHandEl.innerHTML = '';
  playerHandEl.innerHTML = '';
  const showDealerHole = !state.inRound;
  state.dealer.forEach((c,i)=>{
    const card = document.createElement('div'); card.className='card';
    if(i===1 && state.inRound && !showDealerHole){
      card.innerHTML = `<div class="top">?</div><div class="center" style="font-size:20px">?</div><div class="bottom">?</div>`;
      card.style.background = '#111827'; card.style.color='#fff';
    } else {
      card.innerHTML = `<div class="top">${c.v}${c.s}</div><div class="center">${c.s}</div><div class="bottom">${c.v}${c.s}</div>`;
    }
    dealerHandEl.appendChild(card);
  });
  state.player.forEach(c=>{
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `<div class="top">${c.v}${c.s}</div><div class="center">${c.s}</div><div class="bottom">${c.v}${c.s}</div>`;
    playerHandEl.appendChild(card);
  });
  dealerValueEl.textContent = 'Value: ' + (state.inRound ? '?' : handValue(state.dealer));
  playerValueEl.textContent = 'Value: ' + handValue(state.player);
}

/* ---------- Game actions ---------- */

function startRound(){
  const bet = Math.max(1, Math.floor(Number(betInput.value) || 1));
  if(bet > state.credits){ statusEl.textContent = 'Not enough credits'; return; }
  state.bet = bet;
  state.credits -= bet; saveCredits();
  state.deck = newDeck();
  state.player = [state.deck.pop(), state.deck.pop()];
  state.dealer = [state.deck.pop(), state.deck.pop()];
  state.inRound = true;
  renderHands();
  hitBtn.disabled = false; standBtn.disabled = false; dealBtn.disabled = true;
  statusEl.textContent = 'Round started — your move';
  pushLog({ event:'deal', note:`Bet ₹${bet}`, round: {player: state.player, dealer_visible: [state.dealer[0]]} });
  // fast blackjack check
  const pv = handValue(state.player);
  if(pv === 21){
    // blackjack payout 3:2
    const payout = Math.floor(state.bet * 2.5);
    state.credits += payout; saveCredits();
    state.inRound = false;
    statusEl.textContent = `Blackjack! You win ₹${payout}`;
    pushLog({ event:'blackjack', note:`Blackjack! payout ₹${payout}` });
    hitBtn.disabled = true; standBtn.disabled = true; dealBtn.disabled = false;
    renderHands();
  } else {
    renderHands();
  }
}

function playerHit(){
  if(!state.inRound) return;
  const card = state.deck.pop();
  state.player.push(card);
  pushLog({ event:'hit', note:`Drew ${card.v}${card.s}` });
  renderHands();
  const pv = handValue(state.player);
  if(pv > 21){
    state.inRound = false;
    statusEl.textContent = `Bust! You lose.`;
    pushLog({ event:'bust', note:`Player busted ${pv}` });
    hitBtn.disabled = true; standBtn.disabled = true; dealBtn.disabled = false;
    renderHands();
  } else {
    statusEl.textContent = 'You can hit or stand';
  }
}

function dealerPlayAndResolve(){
  if(!state.inRound) return;
  // reveal hole and then draw while <17
  while(handValue(state.dealer) < 17){
    state.dealer.push(state.deck.pop());
  }
  const dv = handValue(state.dealer);
  const pv = handValue(state.player);
  let outcome = 'lose', payout = 0;
  if(pv > 21){ outcome='lose'; payout=0; }
  else if(dv > 21 || pv > dv){ outcome='win'; payout = Math.floor(state.bet * 2); } // return + win
  else if(pv === dv){ outcome='push'; payout = state.bet; }
  else { outcome='lose'; payout=0; }
  if(outcome === 'win'){ state.credits += payout; }
  else if(outcome === 'push'){ state.credits += payout; }
  saveCredits();
  state.inRound = false;
  hitBtn.disabled = true; standBtn.disabled = true; dealBtn.disabled = false;
  statusEl.textContent = outcome === 'win' ? `You win! Payout ₹${payout}` : outcome === 'push' ? 'Push. Bet refunded.' : `Dealer wins.`;
  pushLog({ event:'resolve', note:`Outcome: ${outcome}. Player ${pv} vs Dealer ${dv}. Payout ${payout}` });
  renderHands();
}

/* ---------- UI wire-up ---------- */
function initGame(){
  // initial render
  creditsEl.textContent = state.credits;
  renderLogs();
  renderHands();
  // attach events
  dealBtn.addEventListener('click', startRound);
  hitBtn.addEventListener('click', playerHit);
  standBtn.addEventListener('click', dealerPlayAndResolve);
  resetBtn.addEventListener('click', ()=>{
    if(confirm('Reset credits to ₹1000?')){ state.credits = 1000; saveCredits(); statusEl.textContent='Credits reset'; }
  });
  exportBtn.addEventListener('click', ()=>{
    const logs = localStorage.getItem('bj_logs') || '[]';
    const blob = new Blob([logs], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'blackjack_logs.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  });
  clearLogsBtn.addEventListener('click', ()=>{ if(confirm('Clear logs?')){ localStorage.removeItem('bj_logs'); renderLogs(); }});
  toggleSoundBtn.addEventListener('click', ()=>{ state.sound = !state.sound; toggleSoundBtn.textContent = 'Sound: ' + (state.sound ? 'On' : 'Off'); });
  // keyboard shortcuts for convenience
  window.addEventListener('keydown',(e)=>{
    if(sessionStorage.getItem('bj_access')!=='1') return;
    if(e.key === 'h' || e.key === 'H') { if(!hitBtn.disabled) hitBtn.click(); }
    if(e.key === 's' || e.key === 'S') { if(!standBtn.disabled) standBtn.click(); }
    if(e.key === 'd' || e.key === 'D') { if(!dealBtn.disabled) dealBtn.click(); }
  });
}

/* init UI if already unlocked */
if(sessionStorage.getItem('bj_access')==='1'){ initGame(); }
</script>
</body>
</html>
